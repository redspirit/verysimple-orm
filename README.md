# Simple PHP ORM class
**Очень простой PHP-класс обертка для MySQL которая позволяет проще и безопасней работать с базами данных, составлять запросы и получать результат**

## Подключение

Для использования класса нужно подключить только один файл:

`include('orm.class.php');`

**Подключение к БД:**

`$db = new DBQuery('test', 'root', 'mypass', 'localhost');`

**У этой функции 4 аргумента**

1. название БД
1. имя пользователя
1. пароль пользователя
1. сервер (по-умолчанию localhost)

## Выборка

### Базовый пример:

$q = $db->Query();

$q->table('users');

$q->where('city', 'abakan');

$q->sort('name');

$q->limit(10);

$q->select(function($row){

    print_r($row);

    echo '<br>';

});

Данная конструкция выведет из базы на экран до 10 записей пользователей, которые проживают в Абакане и отсортированы по имени. Методу select() передается функция обратного вызова, которая обрабатывает каждую возвращаемую запросом запись, при этом запрос получает записи со всеми полями в таблице. Если нужно ограничить до нескольких полей, то нужно использовать следующую запись:

`$q->select('name', function($row){ ... });` - выведет записи только с полем name
`$q->select(array('id', 'name', 'gender'), function($row){ ... });` - выведет записи c тремя перечисленными полями
`$q->select(array('id', 'name', 'gender'));` - просто возвратит значение функции mysql_query запроса для последующей обработки результата.

### Сокращенная форма записи запроса

Класс позволяет использовать сокращенную последовательную запись запроса, таким образом первый запрос выборки пользователей можно записать в следующем виде и он вернет аналогичный результат:

$db->Query('users')->where('city', 'abakan')->sort('name')->limit(10)->select(function($row){ ... });

так же можно указать таблицу БД не методом table() а передав название конструктору: `new DBQuery('users');`
Можно указать более одной таблицы если передать массив со списком таблиц: `new DBQuery(array('users', 'profiles'));`

### Выборка одной записи

С помощью метода select_one() можно более удобно получить данные одной записи, функция возвращает ассоциативный массив с данными. Если указать только одно поле $q->select_one('name'); то функция возвратит не массив, а одно значение имени в виде строки, например:

`$db->Query('files')->select_one('AVG(size)');` вернет средний размер всех файлов одним значением, очень удобно

## Вставка

Очень просто, выбираем таблицу и указываем массив с данными

$q = $db->Query('users');

$q->insert(array(
    'name' => 'Maxim',
    'city' => 'Paris'
));

insert() вернет true если вставка удалась, или false в противном случае.

## Обновление

$q = $db->Query('users');

$q->where('id', 12);

$q->update(array(
    'name' => 'Maxim',
    'city' => 'Paris'
));

Выберет запись с id = 12 и обновит данные, указанные в массиве, которые передан методу update();

## Удаление

$q = $db->Query('users');

$q->where('id:<', 10);

$q->delete();

Выберет все записи с id меньше 10 и удалит их.
